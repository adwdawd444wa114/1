# WebSSH 多用户终端

一个基于Web的多用户SSH终端应用，支持实时协作和权限控制。

## 功能特点

- ✅ **多用户支持**: 每个用户拥有独立的终端会话
- ✅ **权限控制**: 用户只能控制自己的终端，但可以查看其他用户的终端输出
- ✅ **🐳 容器隔离**: 每个用户运行在独立的Docker容器中（推荐）
- ✅ **企业级安全防护**: 多层安全防护系统，有效防止各种攻击
- ✅ **智能命令过滤**: 自动拦截危险命令，支持编码绕过检测
- ✅ **IP封禁系统**: 基于IP的自动封禁和手动管理
- ✅ **完整Linux环境**: 用户可以安装任何软件包，完全隔离
- ✅ **速率限制**: 防止命令洪水攻击和恶意行为
- ✅ **实时监控**: 安全事件实时监控和威胁评分系统
- ✅ **管理员工具**: 完整的后台管理功能
- ✅ **实时同步**: 所有用户可以实时看到其他终端的输出
- ✅ **响应式设计**: 支持桌面和移动设备
- ✅ **现代界面**: 基于 xterm.js 的现代终端界面

## 技术栈

- **后端**: Node.js + Express + Socket.IO + node-pty
- **容器**: Docker + Ubuntu 22.04
- **前端**: HTML5 + CSS3 + JavaScript + xterm.js
- **实时通信**: Socket.IO
- **终端模拟**: Docker容器 + node-pty (伪终端) + xterm.js (前端终端)
- **安全**: 容器隔离 + IP封禁 + 命令过滤 + 权限控制

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 选择运行模式

#### 🐳 容器模式（推荐）

**优势**: 完全隔离、安全性最高、用户可以安装任何软件

```bash
# 检查Docker环境
npm run check-docker

# 启动容器模式（默认）
npm start
# 或明确指定
npm run start:container
```

#### 💻 本地模式

**优势**: 无需Docker、启动更快

```bash
# 启动本地模式
npm run start:local
```

### 3. 访问应用

打开浏览器访问: http://localhost:3000

### 4. 管理员工具

```bash
# 启动管理员工具
npm run admin
```

## 使用说明

1. **登录**: 输入用户名加入终端会话
2. **终端控制**:
   - 绿色边框的终端是你的终端，可以输入命令
   - 蓝色边框的终端是其他用户的终端，只能查看
3. **用户列表**: 左侧显示所有在线用户
4. **终端列表**: 显示所有活跃的终端会话
5. **命令安全**: 危险命令会被自动拦截并显示警告

## 安全特性

### 🛡️ 企业级安全防护

#### 1. 根本性安全措施
- **无sudo权限**: 完全移除root权限，从根本上防止系统破坏
- **沙盒环境**: 每个用户运行在独立的受限环境中
- **IP封禁系统**: 基于IP的自动和手动封禁机制
- **白名单机制**: 管理员可设置信任IP白名单

#### 2. 智能命令过滤
- **完全禁用危险命令**: `sudo`, `su`, `passwd`, `mount`, `systemctl` 等
- **系统目录保护**: 禁止访问 `/etc`, `/root`, `/boot`, `/sys` 等
- **编码绕过检测**: base64, hex, unicode 编码的恶意命令
- **命令序列攻击**: 多命令组合和管道攻击检测

#### 3. IP封禁系统
- **自动封禁**: 3次违规自动封禁24小时
- **永久封禁**: 重复违规者永久封禁
- **实时监控**: 实时跟踪IP违规行为
- **管理员控制**: 手动封禁/解封IP地址

#### 4. 速率限制系统
- **命令频率限制**: 每分钟最多60个命令
- **危险命令限制**: 每分钟最多3次危险命令尝试
- **自动封禁**: 超过限制自动临时封禁
- **渐进式惩罚**: 重复违规时间递增

#### 5. 实时安全监控
- **威胁评分系统**: 根据违规行为计算用户威胁等级
- **行为分析**: 检测异常命令模式和攻击序列
- **自动响应**: 高风险用户自动封禁
- **安全日志**: 完整的安全事件记录和审计

#### 6. 高级防护机制
- **命令长度限制**: 防止超长命令攻击
- **特殊字符检测**: 防止混淆和注入攻击
- **Null字节检测**: 防止命令注入
- **进程替换检测**: 防止高级shell技巧绕过

### 🔒 权限控制

- 每个用户只能控制自己的终端
- 所有用户都可以查看其他终端的输出
- 会话隔离，互不干扰
- 自动清理断开连接用户的资源

## 项目结构

```
/
├── package.json          # 项目配置
├── server.js             # 主服务器文件
├── public/               # 前端静态文件
│   ├── index.html        # 主页面
│   ├── style.css         # 样式文件
│   └── client.js         # 客户端逻辑
├── admin-tools.js        # 管理员工具
└── lib/                  # 后端模块
    ├── terminal-manager.js   # 终端管理器
    ├── command-filter.js     # 增强命令过滤器
    ├── session-manager.js    # 会话管理器
    ├── security-monitor.js   # 安全监控器
    ├── security-config.js    # 安全配置文件
    ├── ip-ban-manager.js     # IP封禁管理器
    └── secure-terminal.js    # 安全终端（沙盒）
```

## 管理员工具

系统提供了完整的管理员工具来管理IP封禁和安全监控：

```bash
# 启动管理员工具
node admin-tools.js
```

### 管理功能：
- 📊 查看IP封禁统计
- 📋 查看被封禁的IP列表
- 🚫 手动封禁IP地址
- ✅ 解封IP地址
- ⚪ 添加IP到白名单
- 🔒 查看安全统计
- 📋 查看IP详细信息
- 🧹 清理过期数据

### 联系管理员
如需申诉或有问题，请联系：**zbiuwi@163.com**

## 配置选项

### 环境变量

- `PORT`: 服务器端口 (默认: 3000)

### 自定义配置

- **安全策略**: 可在 `lib/security-config.js` 中自定义安全策略
- **IP封禁配置**: 可调整封禁阈值、时长等参数
- **命令过滤**: 可在 `lib/command-filter.js` 中添加或修改危险命令列表

## 开发

### 启动开发服务器

```bash
npm run dev
```

### 添加新的危险命令

在 `lib/command-filter.js` 中的 `dangerousCommands` 数组中添加新命令。

### 修改终端样式

编辑 `public/style.css` 中的终端相关样式。

## 注意事项

1. 本应用仅用于演示和学习目的
2. 生产环境使用需要额外的安全措施
3. 建议在受控环境中运行
4. 定期更新依赖包以修复安全漏洞

## 许可证

ISC License